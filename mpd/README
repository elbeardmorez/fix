
# PulseOutputPlugin_.dont.lock.in.event.loop.thread.diff [git sha:503ed9c331426d625ddcfef25356d222c13af8a | pending]
-fix SIGABRTs due to the pa_assert / is_worker combo in pa_mainloop_lock
-regression introduced by: '8d6fedf8177d0d2ced81e6d93d35c368b2ac69db [PATCH] Mixer: add class MixerListener' ..specifically the addition

diff --git a/src/mixer/plugins/PulseMixerPlugin.cxx b/src/mixer/plugins/PulseMixerPlugin.cxx
index b838de6..0a765bf 100644
--- a/src/mixer/plugins/PulseMixerPlugin.cxx
+++ b/src/mixer/plugins/PulseMixerPlugin.cxx
92,7 +92,7 @@ PulseMixer::VolumeCallback(const pa_sink_input_info *i, int eol)
  online = true;
  volume = i->volume;

 - GlobalEvents::Emit(GlobalEvents::MIXER);
 + listener.OnMixerVolumeChanged(*this, GetVolume(IgnoreError()));
  }

-this results in new calls to pa_mainloop_lock via pulse_output_lock from within the events loop which is explicitly disallowed as as per the link below the lock is already obtained:

http://freedesktop.org/software/pulseaudio/doxygen/thread-mainloop_8h.html#a2fd002f510ed24cabacb63a26bf4c977

-due to the now mixed use case for GetVolume this patch adds pa_threaded_mainloop_in_thread tests. preferably these additions would have been in PulseMixer::GetVolume but the PulseOutput struct (containing the mainloop reference) is not available from there
